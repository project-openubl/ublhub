---
openapi: 3.0.3
info:
  title: Ublhub API
  description: Ublhub REST API definitions for you to consume.
  termsOfService: https://github.com/project-openubl/ublhub/blob/master/CODE_OF_CONDUCT.md
  contact:
    name: Ublhub API Support
    url: https://project-openubl.github.io/
    email: projectopenubl@googlegroups.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: 2.0.0-SNAPSHOT
servers:
- url: http://localhost:8080
  description: Auto generated value
- url: http://0.0.0.0:8080
  description: Auto generated value
paths:
  /api/api/namespaces/{projectId}/document-files/{documentId}:
    get:
      tags:
      - Document File Resource
      parameters:
      - name: documentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: requestedFile
        in: query
        schema:
          default: ubl
          type: string
      - name: requestedFormat
        in: query
        schema:
          default: zip
          type: string
      responses:
        "200":
          description: OK
  /api/api/projects:
    get:
      tags:
      - Project Resource
      summary: List projects
      description: List all projects
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
    post:
      tags:
      - Project Resource
      summary: Create project
      description: Create a project
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/check-name:
    post:
      tags:
      - Project Resource
      summary: List projects
      description: List all projects
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckCompanyDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: string
  /api/api/projects/{projectId}:
    get:
      tags:
      - Project Resource
      summary: Get project
      description: Get one project
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
    put:
      tags:
      - Project Resource
      summary: Update project
      description: Update one project
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
    delete:
      tags:
      - Project Resource
      summary: Delete project
      description: Delete one project
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "204":
          description: No Content
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/companies:
    get:
      tags:
      - Company Resource
      summary: List companies
      description: List all companies
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CompanyDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
    post:
      tags:
      - Company Resource
      summary: Create company
      description: Create a company
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/companies/{companyId}:
    get:
      tags:
      - Company Resource
      summary: Get company
      description: Get one company
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
      - SecurityScheme:
        - admin:app
        - project:write
        - project:read
    put:
      tags:
      - Company Resource
      summary: Update company
      description: Update one company
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
    delete:
      tags:
      - Company Resource
      summary: Delete company
      description: Delete one company
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "204":
          description: No Content
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/companies/{companyId}/components:
    get:
      tags:
      - Keys Resource
      summary: Get company components
      description: List of components
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: name
        in: query
        schema:
          type: string
      - name: parent
        in: query
        schema:
          format: int64
          type: integer
      - name: type
        in: query
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
    post:
      tags:
      - Keys Resource
      summary: Create a company component
      description: Create component
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComponentDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/companies/{companyId}/components/{componentId}:
    get:
      tags:
      - Keys Resource
      summary: Get company component
      description: Get one component
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
    put:
      tags:
      - Keys Resource
      summary: Update company component
      description: Update a component
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComponentDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
    delete:
      tags:
      - Keys Resource
      summary: Delete a company component
      description: Delete a component
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "204":
          description: No Content
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/companies/{companyId}/keys:
    get:
      tags:
      - Keys Resource
      summary: Get company keys
      description: List of keys
      parameters:
      - name: companyId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeysMetadataRepresentation'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
  /api/api/projects/{projectId}/components:
    get:
      tags:
      - Keys Resource
      summary: Get project components
      description: List of components
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: name
        in: query
        schema:
          type: string
      - name: parent
        in: query
        schema:
          format: int64
          type: integer
      - name: type
        in: query
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
    post:
      tags:
      - Keys Resource
      summary: Create a project component
      description: Create component
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComponentDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/components/{componentId}:
    get:
      tags:
      - Keys Resource
      summary: Get project component
      description: Get one component
      parameters:
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
    put:
      tags:
      - Keys Resource
      summary: Update project component
      description: Update a component
      parameters:
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComponentDto'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentDto'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
    delete:
      tags:
      - Keys Resource
      summary: Delete a project component
      description: Delete a component
      parameters:
      - name: componentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "204":
          description: No Content
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:write
      - SecurityScheme:
        - admin:app
        - project:write
  /api/api/projects/{projectId}/documents:
    get:
      tags:
      - Document Resource
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: documentType
        in: query
        schema:
          type: array
          items:
            type: string
      - name: filterText
        in: query
        schema:
          type: string
      - name: limit
        in: query
        schema:
          format: int32
          default: "10"
          type: integer
      - name: offset
        in: query
        schema:
          format: int32
          default: "0"
          type: integer
      - name: ruc
        in: query
        schema:
          type: array
          items:
            type: string
      - name: sort_by
        in: query
        schema:
          default: created:desc
          type: array
          items:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageDtoDocumentDto'
    post:
      tags:
      - Document Resource
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JsonObject'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
  /api/api/projects/{projectId}/documents/{documentId}:
    get:
      tags:
      - Document Resource
      parameters:
      - name: documentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
  /api/api/projects/{projectId}/documents/{documentId}/cdr:
    get:
      tags:
      - Document Resource
      parameters:
      - name: documentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: unzip
        in: query
        schema:
          default: true
          type: boolean
      responses:
        "200":
          description: OK
  /api/api/projects/{projectId}/documents/{documentId}/xml:
    get:
      tags:
      - Document Resource
      parameters:
      - name: documentId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: unzip
        in: query
        schema:
          default: true
          type: boolean
      responses:
        "200":
          description: OK
  /api/api/projects/{projectId}/enrich-document:
    post:
      tags:
      - Document Resource
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JsonObject'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
  /api/api/projects/{projectId}/keys:
    get:
      tags:
      - Keys Resource
      summary: Get project keys
      description: List of keys
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeysMetadataRepresentation'
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme:
        - admin:app
        - project:read
      - SecurityScheme:
        - admin:app
        - project:read
  /api/api/projects/{projectId}/render-document:
    post:
      tags:
      - Document Resource
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JsonObject'
      responses:
        "200":
          description: OK
          content:
            text/xml:
              schema:
                type: string
            application/octet-stream:
              schema:
                type: string
  /api/api/projects/{projectId}/upload/document:
    post:
      tags:
      - Document Resource
      parameters:
      - name: projectId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  $ref: '#/components/schemas/FileUpload'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
  /api/api/server-info:
    get:
      tags:
      - Server Info Resource
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerInfoDto'
components:
  schemas:
    CheckCompanyDto:
      required:
      - name
      type: object
      properties:
        name:
          type: string
    CompanyDto:
      required:
      - ruc
      - name
      type: object
      properties:
        id:
          type: string
        ruc:
          maxLength: 11
          minLength: 11
          type: string
        name:
          type: string
        description:
          maxLength: 250
          type: string
        sunat:
          $ref: '#/components/schemas/SunatDto'
    ComponentDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        providerId:
          type: string
        providerType:
          type: string
        parentId:
          type: string
        subType:
          type: string
        config:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
    ComponentTypeRepresentation:
      type: object
      properties:
        id:
          type: string
        helpText:
          type: string
        properties:
          type: array
          items:
            $ref: '#/components/schemas/ConfigPropertyRepresentation'
        metadata:
          type: object
          additionalProperties:
            type: object
    ConfigPropertyRepresentation:
      type: object
      properties:
        name:
          type: string
        label:
          type: string
        helpText:
          type: string
        type:
          type: string
        defaultValue:
          type: object
        options:
          type: array
          items:
            type: string
        secret:
          type: boolean
        readOnly:
          type: boolean
    DocumentDto:
      type: object
      properties:
        id:
          type: string
        created:
          format: int64
          type: integer
        updated:
          format: int64
          type: integer
        status:
          $ref: '#/components/schemas/Status'
    Error:
      type: object
      properties:
        phase:
          $ref: '#/components/schemas/JobPhaseType'
        description:
          type: string
        recoveryActionCount:
          format: int32
          type: integer
        recoveryAction:
          $ref: '#/components/schemas/JobRecoveryActionType'
    FileUpload:
      type: object
    JobPhaseType:
      enum:
      - READ_XML_FILE
      - SEND_XML_FILE
      - VERIFY_TICKET
      type: string
    JobRecoveryActionType:
      enum:
      - RETRY_SEND
      - RETRY_FETCH_CDR
      type: string
    JsonObject:
      type: array
    KeyMetadataRepresentation:
      type: object
      properties:
        providerId:
          type: string
        providerPriority:
          format: int64
          type: integer
        kid:
          type: string
        status:
          type: string
        type:
          type: string
        algorithm:
          type: string
        publicKey:
          type: string
        certificate:
          type: string
        use:
          $ref: '#/components/schemas/KeyUse'
    KeyUse:
      enum:
      - SIG
      - ENC
      type: string
    KeysMetadataRepresentation:
      type: object
      properties:
        active:
          type: object
          additionalProperties:
            type: string
        keys:
          type: array
          items:
            $ref: '#/components/schemas/KeyMetadataRepresentation'
    PageDtoDocumentDto:
      type: object
      properties:
        count:
          format: int64
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/DocumentDto'
    ProjectDto:
      required:
      - name
      - sunat
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          maxLength: 250
          type: string
        sunat:
          $ref: '#/components/schemas/SunatDto'
    ServerInfoDto:
      type: object
      properties:
        componentTypes:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/ComponentTypeRepresentation'
    Status:
      type: object
      properties:
        inProgress:
          type: boolean
        xmlData:
          $ref: '#/components/schemas/XMLData'
        sunat:
          $ref: '#/components/schemas/Sunat'
        error:
          $ref: '#/components/schemas/Error'
    Sunat:
      type: object
      properties:
        code:
          format: int32
          type: integer
        ticket:
          type: string
        status:
          type: string
        description:
          type: string
        hasCdr:
          type: boolean
        notes:
          type: array
          items:
            type: string
    SunatDto:
      required:
      - facturaUrl
      - guiaUrl
      - retencionUrl
      - username
      - password
      type: object
      properties:
        facturaUrl:
          type: string
        guiaUrl:
          type: string
        retencionUrl:
          type: string
        username:
          maxLength: 250
          minLength: 3
          type: string
        password:
          maxLength: 250
          minLength: 3
          type: string
    XMLData:
      type: object
      properties:
        ruc:
          type: string
        serieNumero:
          type: string
        tipoDocumento:
          type: string
